{% extends "base.html" %}
{% load static %}
{% block meta %} 
    <title>My Wishlist</title> 
{% endblock meta %}

{% block content %}
    {% include "navbar.html" %}
    <div class="container mx-auto py-8 mt-20"> <!-- Sesuaikan margin-top di sini untuk jarak navbar -->
        <h1 class="text-4xl font-extrabold text-center mb-10 text-gray-700">My Wishlist</h1>

        {% if wishlist_items %}
            <ul class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 px-4">
                {% for item in wishlist_items %}
                    <li class="bg-white shadow-lg rounded-xl p-6 hover:shadow-2xl transform hover:-translate-y-2 transition duration-300 ease-in-out">
                        <h3 class="text-2xl font-semibold text-gray-800">{{ item.restaurant.name }}</h3>
                        <p class="text-gray-600 mt-4 text-sm">{{ item.restaurant.description }}</p>
                        <small class="text-gray-400 mt-6 block">Added on: {{ item.added_at|date:"F j, Y" }}</small>
                        
                        <!-- Tombol Hapus dari Wishlist -->
                        <button onclick="removeFromWishlist('{{ item.restaurant.id }}')" 
                                class="bg-red-500 text-white px-4 py-2 rounded mt-4 hover:bg-red-700 transition">
                            Remove from Wishlist
                        </button>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <div class="flex flex-col items-center mt-10">
                <img src="{% static 'images/empty_wishlist.png' %}" alt="Empty Wishlist" class="w-40 h-40 opacity-75">
                <p class="text-gray-500 mt-6 text-lg font-medium text-center">
                    Your wishlist is currently empty.<br> Start adding some items!
                </p>
            </div>
        {% endif %}
    </div>

    <!-- JavaScript untuk menghapus item dari wishlist dengan AJAX -->
    <script>
        function removeFromWishlist(restaurantId) {
            fetch(`/wishlist/remove/${restaurantId}/`, {
                method: "POST",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}", // Menggunakan CSRF token untuk keamanan
                    "Content-Type": "application/json"
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.deleted) {
                    alert("Item removed from wishlist.");
                    location.reload(); // Memuat ulang halaman untuk memperbarui daftar
                } else {
                    alert("Failed to remove item from wishlist.");
                }
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
{% endblock content %}
